#!/usr/bin/env bash

export LANG=en_US.UTF-8
set -e

pod_install() {
  if [[ -x $(which pod) ]]; then
    # Check if this is a fresh install (no Pods directory)
    if [[ ! -d "ios/Pods" ]]; then
      echo ""
      echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      echo "â•‘  ðŸ§¹ FRESH POD INSTALLATION - Installing from scratch       â•‘"
      echo "â•‘  ðŸ“¦ Downloading all 108 CocoaPods (may take 1-2 minutes)   â•‘"
      echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
    else
      echo ""
      echo "=> ðŸ”„ Updating CocoaPods..."
      echo ""
    fi

    if [[ "$IOS_SCHEME" == "" ]]; then
      bundle exec pod install --project-directory=ios
    else
      bundle exec pod install --deployment --project-directory=ios
    fi
    
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  âœ… POD INSTALLATION COMPLETE!                             â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
  else
    echo "=> âš ï¸  Cocoapods not installed; skipping."
  fi
}

if [[ "$SKIP_COCOAPODS" != "yes" ]]; then
  pod_install
else
  echo "=> Skipping Cocoapods install."
fi
